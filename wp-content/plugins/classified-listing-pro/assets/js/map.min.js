!function(e){function t(t){var a=new google.maps.Geocoder,i=function(){var t=[],n={};return e(".rtcl-map-field").map(function(){if(e(this).is(":visible")){var t=e(this).getType();"text"!==t&&"textarea"!==t||!e(this).val()?"select"===t&&e(this).find("option:selected").val()&&(n[e(this).attr("name")]=e(this).find("option:selected").text()):n[e(this).attr("name")]=e(this).val()}}),["address","sub_sub_location","sub_location","location","zipcode"].map(function(e){void 0!==n[e]&&t.push(n[e])}),t=(t=t.filter(function(e){return""!==e})).join()}();a.geocode({address:i},function(e,a){if(a===google.maps.GeocoderStatus.OK){var i=e[0].geometry.location,s=t.markers[0];s.setPosition(i),o(t),n(i),google.maps.event.addListener(s,"dragend",function(){var e=s.getPosition();t.panTo(e),n(e)})}})}function n(t){e("#rtcl-latitude").val(t.lat()),e("#rtcl-longitude").val(t.lng())}function o(t){var n=new google.maps.LatLngBounds;e.each(t.markers,function(e,t){var o=new google.maps.LatLng(t.position.lat(),t.position.lng());n.extend(o)}),1===t.markers.length?(t.setCenter(n.getCenter()),t.setZoom(parseInt(rtcl.zoom_level))):t.fitBounds(n)}e(function(){var a=e(".rtcl-map-view");a.length&&a.each(function(){!function(t){var n,o,a=new google.maps.LatLngBounds,i={center:new google.maps.LatLng(0,0),zoom:3,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:""},s=new InfoBox({enableEventPropagation:!0,maxWidth:350,infoBoxClearance:new google.maps.Size(50,50),alignBottom:!0,pixelOffset:new google.maps.Size(-47,-75)}),l=[],r=[],p=t.data("map-type")||"",g=t.data("map-data")||[];"search"===p&&(d=[],e(".rtcl-search-map-lat-long").each(function(){var t=e(this),n=t.parents(".rtcl-listing-item"),o=e("<div />");o.append(n.find(".rtcl-media").clone()),o.append(e('<h5 class="rtcl-map-item-title" />').append(n.find(".listing-title a").clone())),o.find("h5").wrap('<div class="flex-right"></div>'),o.find(".flex-right").append('<div class="bottom-rtcl-meta flex-wrap"></div>'),o.find(".bottom-rtcl-meta").append(n.find(".rtcl-price-amount").clone()),o.find("a").addClass("text-overflow").attr("target","_blank"),d.push({latitude:t.data("latitude"),longitude:t.data("longitude"),id:t.data("id"),icon:t.data("icon"),content:o.html(),parent:n})}),g=d);var d;o=new google.maps.Map(t[0],i),e.each(g,function(e,t){var n=Object.assign({id:0,latitude:0,longitude:0,icon:"",content:""},t),i=new google.maps.LatLng(n.latitude,n.longitude);n.latitude,n.latitude;if(-1===r.indexOf(n.id)){r.push(n.id),a.extend(i);var p=new google.maps.Marker({position:i,icon:n.icon,content:n.content,map:o});l.push(p),p.addListener("click",function(){s.close(),s.setContent(p.content),s.setOptions({pixelOffset:new google.maps.Size(-47,-75)}),s.open(o,p)})}}),n=new MarkerClusterer(o,l,{imagePath:rtcl.plugin_url+"/assets/images/map/m"}),google.maps.event.addListener(n,"click",function(t){s.close();for(var a,i=t.getMarkers(),l=!0,r=0;r<i.length;r++)a?a.equals(i[r].position)||(l=!1):a=i[r].position;if(l){var p='<ul class="list-unstyled info-box-markers-list">',i=t.getMarkers();e.each(i,function(e,t){p+="<li>"+t.content+"</li>"}),p+="</ul>",s.setContent(p),s.setOptions({pixelOffset:new google.maps.Size(-45,-50)}),s.open(o,i[i.length-1]),setTimeout(function(){e(".info-box-markers-list").scrollbar()},50),n.setZoomOnClick(!1)}}),o.fitBounds(a)}(e(this))}),e(".rtcl-map").each(function(){var a,i,s,l;a=e(this),i=a.find(".marker"),s={zoom:parseInt(rtcl.zoom_level)||16,center:new google.maps.LatLng(0,0),mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControl:!0,scrollwheel:!1},(l=new google.maps.Map(a[0],s)).markers=[],l.type=a.data("type"),i.each(function(a){var i,s,r=e(this),p=r.data("latitude")||"",g=r.data("longitude")||"",d=r.data("address")||"";if(p&&g)i=new google.maps.LatLng(p,g);else if(d){var c=new google.maps.Geocoder;c.geocode({address:d},function(e,t){if(t===google.maps.GeocoderStatus.OK){var a=new google.maps.Marker({map:l,position:e[0].geometry.location,draggable:"input"===l.type});if(l.markers.push(a),r.html()){var i=new google.maps.InfoWindow({content:r.html()});google.maps.event.addListener(a,"click",function(){i.open(l,a)})}"input"===l.type&&google.maps.event.addListener(a,"dragend",function(){var e=a.getPosition();l.panTo(e),n(e)}),o(l)}})}else if("input"===l.type){var m=new google.maps.Marker({map:l,position:new google.maps.LatLng(0,0),draggable:!0});google.maps.event.addListener(m,"dragend",function(){var e=m.getPosition();l.panTo(e),n(e)}),l.markers.push(m),t(l)}if(i){if(s=new google.maps.Marker({position:i,map:l,draggable:"input"===l.type}),l.markers.push(s),r.html()){var u=new google.maps.InfoWindow({content:r.html()});google.maps.event.addListener(s,"click",function(){u.open(l,s)})}"input"===l.type&&google.maps.event.addListener(s,"dragend",function(){var e=s.getPosition();l.panTo(e),n(e)})}"input"===l.type&&e(".rtcl-map-field").on("blur change keyup",function(){t(l)})}),o(l)})})}(jQuery);
