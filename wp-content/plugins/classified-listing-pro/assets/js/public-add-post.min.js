!function(e){e.fn.getType=function(){return"INPUT"==this[0].tagName?this[0].type.toLowerCase():this[0].tagName.toLowerCase()};var t='<div class="rtcl-spinner block"><span class="rtcl-icon-spinner animate-spin"></span></div>';if(e(document.body).on("rtcl_add_error_tip",function(t,r,a){var s=r.position();0===r.parent().find(".rtcl_error_tip").length&&(r.after('<div class="rtcl_error_tip '+a+'">'+rtcl[a]+"</div>"),r.parent().find(".rtcl_error_tip").css("left",s.left+r.width()-r.width()/2-e(".rtcl_error_tip").width()/2).css("top",s.top+r.height()).fadeIn("100"))}).on("rtcl_remove_error_tip",function(t,r,a){r.parent().find(".rtcl_error_tip."+a).fadeOut("100",function(){e(this).remove()})}).on("click",function(){e(".rtcl_error_tip").fadeOut("100",function(){e(this).remove()})}).on("blur","#rtcl-price[type=text]",function(){e(".rtcl_error_tip").fadeOut("100",function(){e(this).remove()})}).on("keyup","#rtcl-price[type=text]",function(){var t=new RegExp("[^-0-9%\\"+rtcl.decimal_point+"]+","gi"),r="i18n_mon_decimal_error",a=e(this).val(),s=a.replace(t,"");a!==s?e(document.body).triggerHandler("rtcl_add_error_tip",[e(this),r]):e(document.body).triggerHandler("rtcl_remove_error_tip",[e(this),r])}).on("change","#rtcl-price[type=text]",function(){var t=new RegExp("[^-0-9%\\"+rtcl.decimal_point+"]+","gi"),r=e(this).val(),a=r.replace(t,"");r!==a&&e(this).val(a)}).on("rtcl_price_type_changed",function(t,r){"on_call"==r.value||"free"==r.value||"no_price"==r.value?(e("#rtcl-price").attr("required","false").val(""),e("#rtcl-price-row").hide()):(e("#rtcl-price").attr("required","true"),e("#rtcl-price-row").show())}).on("change","#rtcl-price-type",function(){e(document.body).trigger("rtcl_price_type_changed",[this])}),e.fn.validate){var r=e("form#rtcl-post-form");r.length&&r.validate({submitHandler:function(t){try{tinymce.triggerSave(),tinymce.get("description").save()}catch(e){}if(rtcl.recaptcha_listing>0&&0===grecaptcha.getResponse(rtcl.recaptcha_responce.listing).length)return e("#rtcl-listing-g-recaptcha-message").addClass("text-danger").html(rtcl.recaptcha_invalid_message),grecaptcha.reset(rtcl.recaptcha_responce.listing),!1;var a=e(t),s=e("<div class='alert rtcl-response'></div>");return e.ajax({url:rtcl.ajaxurl,type:"POST",dataType:"json",data:e(t).serialize()+"&action=rtcl_post_new_listing",beforeSend:function(){a.find(".alert.rtcl-response").remove(),a.find("button[type=submit]").prop("disabled",!0),a.rtclBlock()},success:function(e){a.find("button[type=submit]").prop("disabled",!1),a.rtclUnblock();var t="";e.message.length&&e.message.map(function(e){t+="<p>"+e+"</p>"}),e.success?(r[0].reset(),t&&s.removeClass("alert-danger").addClass("alert-success").html(t).appendTo(r),e.redirect_url&&setTimeout(function(){window.location.href=e.redirect_url},500)):t&&s.removeClass("alert-success").addClass("alert-danger").html(t).appendTo(r)},error:function(e){s.removeClass("alert-success").addClass("alert-danger").html(e.responseText).appendTo(r),a.find("button[type=submit]").prop("disabled",!1),a.rtclUnblock()}}),!1}})}e(function(){e("#rtcl-ad-type").on("change",function(){var r=e(this),a=r.val(),s=e("<div class='alert rtcl-response'></div>"),c=r.parents("#rtcl-ad-type-selection"),n=e("#rtcl-ad-category-selection"),l=e("#rtcl-sub-category-wrap"),o=e("#sub-cat-row"),i={action:"rtcl_get_one_level_category_select_list_by_type",type:a};a?e.ajax({url:rtcl.ajaxurl,data:i,type:"POST",dataType:"json",beforeSend:function(){e(t).insertAfter(r),c.find(".alert.rtcl-response").remove(),n.find(".alert.rtcl-response").remove(),o.addClass("rtcl-hide"),l.html("")},success:function(t){r.next(".rtcl-spinner").remove(),o.addClass("rtcl-hide"),l.html("");var a="";t.message.length&&t.message.map(function(e){a+="<p>"+e+"</p>"}),t.success?(e("#rtcl-category").html(t.cats),n.slideDown()):(e("#rtcl-category").html(""),n.slideUp(),a&&s.removeClass("alert-success").addClass("alert-danger").html(a).appendTo(c))},error:function(e){r.next(".rtcl-spinner").remove(),s.removeClass("alert-success").addClass("alert-danger").html(e.responseText).appendTo(c)}}):(n.slideUp(),o.addClass("rtcl-hide"),l.html(""))}),e("#rtcl-category").on("change",function(){var r=e(this),a=r.parents(".rtcl-post-category"),s=e("#rtcl-sub-category-wrap"),c=e("#sub-cat-row"),n=e(this).val(),l=e("#rtcl-ad-type"),o=l.val()||"",i=e("<div class='alert rtcl-response'></div>"),d={action:"rtcl_get_one_level_category_select_list",term_id:n};!o&&rtcl_add_post.hide_ad_type||o&&!rtcl_add_post.hide_ad_type?n?e.ajax({url:rtcl.ajaxurl,data:d,type:"POST",dataType:"json",beforeSend:function(){e(t).insertAfter(r),a.find(".alert.rtcl-response").remove()},success:function(t){if(r.next(".rtcl-spinner").remove(),t.success)if(t.child_cats)s.html(e('<select class="form-control" required />').append(t.child_cats)),c.removeClass("rtcl-hide");else{s.html(""),c.addClass("rtcl-hide");var l=rtcl_add_post.form_uri.toString(),d={category:n},p=-1!==l.indexOf("?")?"&":"?";!rtcl_add_post.hide_ad_type&&o&&(d.type=o),l=l+p+e.param(d),window.location=l}else if(c.addClass("rtcl-hide"),t.message.length){var u="";t.message.map(function(e){u+="<p>"+e+"</p>"}),u&&i.removeClass("alert-success").addClass("alert-danger").html(u).appendTo(a)}},error:function(e){r.next(".rtcl-spinner").remove(),i.removeClass("alert-success").addClass("alert-danger").html(e.responseText).appendTo(a)}}):(s.html(""),c.addClass("rtcl-hide")):(alert(rtcl_add_post.message.ad_type),l.focus())}),e(document).on("change","#rtcl-sub-category-wrap select",function(){var r=e(this),a=r.parents("#rtcl-sub-category-wrap"),s=e(this).val(),c=e("#rtcl-ad-type"),n=c.val()||"",l=e("<div class='alert rtcl-response'></div>"),o={action:"rtcl_get_one_level_category_select_list",term_id:s};!n&&rtcl_add_post.hide_ad_type||n&&!rtcl_add_post.hide_ad_type?s?e.ajax({url:rtcl.ajaxurl,data:o,type:"POST",dataType:"json",beforeSend:function(){e(t).insertAfter(r),a.find(".alert.rtcl-response").remove(),r.nextAll("select").remove()},success:function(t){if(a.find(".rtcl-spinner").remove(),t.success)if(t.child_cats)a.append(e('<select class="form-control" required />').append(t.child_cats));else{var c=rtcl_add_post.form_uri.toString(),o={category:s},i=-1!==c.indexOf("?")?"&":"?";!rtcl_add_post.hide_ad_type&&n&&(o.type=n),c=c+i+e.param(o),window.location=c}else if(r.nextAll("select").remove(),t.message.length){var d="";t.message.map(function(e){d+="<p>"+e+"</p>"}),d&&l.removeClass("alert-success").addClass("alert-danger").html(d).appendTo(a)}},error:function(e){a.find(".rtcl-spinner").remove(),l.removeClass("alert-success").addClass("alert-danger").html(e.responseText).appendTo(a)}}):r.nextAll("select").remove():(alert(rtcl_add_post.message.ad_type),c.focus())}),e("#rtcl-location").on("change",function(){var r=e(this),a=e("#rtcl-sub-location"),s=a.parents("#sub-location-row"),c={action:"rtcl_get_sub_location_options",term_id:e(this).val()};e.ajax({url:rtcl.ajaxurl,data:c,type:"POST",dataType:"json",beforeSend:function(){e(t).insertAfter(r)},success:function(t){r.next(".rtcl-spinner").remove(),a.find("option").each(function(){e(this).val().trim()&&e(this).remove()}),a.append(t.locations),t.locations?s.removeClass("rtcl-hide"):s.addClass("rtcl-hide")},error:function(){r.next(".rtcl-spinner").remove()}})}),e("#rtcl-sub-location").on("change",function(){var r=e(this),a=e("#rtcl-sub-sub-location"),s=a.parents("#sub-sub-location-row"),c={action:"rtcl_get_sub_location_options",term_id:e(this).val()};e.ajax({url:rtcl.ajaxurl,data:c,type:"POST",dataType:"json",beforeSend:function(){e(t).insertAfter(r)},success:function(t){r.next(".rtcl-spinner").remove(),a.find("option").each(function(){e(this).val().trim()&&e(this).remove()}),a.append(t.locations),t.locations?s.removeClass("rtcl-hide"):s.addClass("rtcl-hide")},error:function(){r.next(".rtcl-spinner").remove()}})})}),e(window).bind("beforeunload",function(){var t=parseInt(e("#_post_id").val(),10);if(t&&0!==t&&!isNaN(t)){var r={action:"rtcl_delete_temp_listing",__rtcl_wpnonce:rtcl.__rtcl_wpnonce,id:t};e.ajax(rtcl.ajaxurl,{data:r,dataType:"json",type:"post",success:function(e){}})}})}(jQuery);
